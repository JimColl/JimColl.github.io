<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="James Matthew Coll">

  
  
  
    
  
  <meta name="description" content="Introduction to Remote Sensing Remote sensing is a course onto itself, but it’s worth introducing here as GIScience, GISystems, and remote sensing overlap more than they diverge. Remote sensing, as opposed to in-situ measurement, is the measurement of an object from a distance, most often a great distance.
Objectives This lab should provide you with the bulk of the background knowledge needed to dive further into the field of remote sensing.">

  
  <link rel="alternate" hreflang="en-us" href="https://jimcoll.github.io/courses/random/foss_rs/">

  


  

  
  
  
  <meta name="theme-color" content="#4caf50">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="anonymous">
    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.4b7f23026d0679370dc79f3ff7783adf.css">

  

  
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://jimcoll.github.io/courses/random/foss_rs/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Jim Coll">
  <meta property="og:url" content="https://jimcoll.github.io/courses/random/foss_rs/">
  <meta property="og:title" content=" | Jim Coll">
  <meta property="og:description" content="Introduction to Remote Sensing Remote sensing is a course onto itself, but it’s worth introducing here as GIScience, GISystems, and remote sensing overlap more than they diverge. Remote sensing, as opposed to in-situ measurement, is the measurement of an object from a distance, most often a great distance.
Objectives This lab should provide you with the bulk of the background knowledge needed to dive further into the field of remote sensing."><meta property="og:image" content="https://jimcoll.github.io/img/icon-192.png">
  <meta property="twitter:image" content="https://jimcoll.github.io/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
    
  

  


  





  <title> | Jim Coll</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Jim Coll</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Main Website</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/geog358/"><span>GEOG 358</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/geog558/"><span>GEOG 558</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/courses/random/"><span>Random</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/random/">Links and other useful sites</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/random/website/">Website creation</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/random/foss/">Creating FOSS Tools</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/random/dronemapping/">Drone Mapping</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/random/firstgoogleearthmap/">Intro to Google Earth</a>

  </div>
  
  <div class="docs-toc-item active">
    <a class="docs-toc-link" href="/courses/random/foss_rs/">R - NDVI</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/random/gee_intro/">Introduction to GEE</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/random"></a>

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction-to-remote-sensing"><strong>Introduction to Remote Sensing</strong></a></li>
<li><a href="#objectives"><strong>Objectives</strong></a></li>
<li><a href="#quick-vocab"><strong>Quick vocab</strong></a></li>
<li><a href="#the-basics"><strong>The basics</strong></a></li>
<li><a href="#an-introduction-to-platforms"><strong>An introduction to platforms</strong></a>
<ul>
<li><a href="#modis"><strong>MODIS</strong></a></li>
<li><a href="#landsat"><strong>LANDSAT</strong></a>
<ul>
<li><a href="#landsat-distro"><strong>LANDSAT distro</strong></a></li>
<li><a href="#landsat-1"><strong>LANDSAT</strong></a></li>
</ul></li>
</ul></li>
<li><a href="#a-simple-application"><strong>A simple application</strong></a></li>
<li><a href="#lab-exercise"><strong>Lab exercise</strong></a>
<ul>
<li><a href="#first-let-s-load-in-the-requisite-packages">First, let&rsquo;s load in the requisite packages</a></li>
<li><a href="#define-a-few-helper-functions">Define a few helper functions</a></li>
<li><a href="#define-our-aoi-and-a-small-processing-area">Define our AOI and a small processing area</a></li>
<li><a href="#discover-approprite-scenes-for-processing">Discover approprite scenes for processing</a></li>
<li><a href="#discover-approprite-scenes-for-processing-part-2">Discover approprite scenes for processing <strong>part 2</strong></a></li>
<li><a href="#creating-ndvi-values">Creating NDVI values</a></li>
<li><a href="#grabbing-land-cover">Grabbing land cover</a></li>
<li><a href="#zonal-statistics">zonal statistics</a></li>
<li><a href="#finishing-up">Finishing up</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name"></h1>

          <div class="article-style" itemprop="articleBody">
            

<h2 id="introduction-to-remote-sensing"><strong>Introduction to Remote Sensing</strong></h2>

<p><img src="/courses/geog358/media/GPSSplash.jpg" alt="" /></p>

<p>Remote sensing is a course onto itself, but it’s worth introducing here as GIScience, GISystems, and remote sensing overlap more than they diverge.  Remote sensing, as opposed to in-situ measurement, is the measurement of an object from a distance, most often a great distance.</p>

<h2 id="objectives"><strong>Objectives</strong></h2>

<p>This lab should provide you with the bulk of the background knowledge needed to dive further into the field of remote sensing.  We&rsquo;ll cover common terminology and technology, some basic applications, and cover how R can be used to perform common GIScience and remote sensing operations.</p>

<h2 id="quick-vocab"><strong>Quick vocab</strong></h2>

<p>To start off, lets review some key vocabulary that often comes up when discussing remote sensing.  These definitions are important when discussing concepts such as distortion and illumination angles but will only crop up sporadically.</p>

<ul>
<li>In physics, the <strong>nadir</strong> direction for a given location is the local vertical direction pointing in the direction the force of gravity acts at that location.  In remote sensing this concept is, in essence, the point on a photo which is directly below the satellite.  It&rsquo;s opposite direction, <strong>zenith</strong>, refers to the direction directly opposed to gravity.<br /></li>
<li><strong>Julian days</strong> are equivalent to Day of the Year, starting on January first of each year.</li>
<li><strong>Epoch time</strong>, also know as Unix time or POSIX time, is the number of seconds that have elapsed since January first, 1970 at midnight GMT/UTC, and is often used to indicate the timestamp of the data. (<a href="https://www.epochconverter.com/">handy web converter</a>)</li>
<li>Remote sensing data comes from <strong>instruments</strong>, or sensors, which in turn are housed aboard <strong>platforms</strong>, or satellites.</li>
</ul>

<h2 id="the-basics"><strong>The basics</strong></h2>

<p>It’s difficult to learn about remote sensing without first recalling some basic physics.  First, take a second and recall how eyesight and vision works, using the conceptual diagram below.</p>

<p><img src="/courses/random/media/placeholdereyesremotesensing.gif" alt="" /></p>

<p>Remote sensing is the measurement of the electromagnetic spectrum.  Energy (not necessarily in the visible spectrum) from a source, strikes the object, and then travels to the eye.  We’ll break this down a little further.  There are several different flavors of remote sensing, but the two most common ones are:</p>

<ul>
<li><strong>Active sensing</strong>: A sensor or pair of instruments that both emit and receive measurements.  Common examples of active remote sensing include ground penetrating radar, sonar, and LIDAR.</li>
<li><strong>Passive sensing</strong>: A sensor which only receives measurements.  These are some of the most common forms of sensors, examples of which include: Your eyes, cameras, and most earth orbiting satellites.</li>
</ul>

<p>Next we need to introduce the most common properties used to differentiate and classify different remote sensing platforms.  These properties are all in the context of scale and resolution.</p>

<p><strong>Radiometric resolution</strong>: Radiometric resolution is the number of brightness levels that can be detected by the sensor, also known as radiometric sensitivity, quantization, or simply the number of bits per pixel.
<img src="/courses/random/media/RadiometricResolution.png" alt="" /></p>

<p><strong>Spectral resolution</strong>: Spectral resolution refers to the number and position of the sensor bands along the EM spectrum.
<img src="/courses/random/media/SpectralResolution.png" alt="" /></p>

<p><strong>Spatial resolution</strong>: Spatial resolution is the ground distance of the pixel, and is typically reported in meters at nadir at the equator.
<img src="/courses/random/media/tempSpatialResolution.png" alt="" /></p>

<p><strong>Temporal resolution</strong>: Temporal resolution, or more directly refereed to as revisit time, is, as the name suggests, the time between a repeated observation of the same place on the globe.  Temporal resolution is the result of a number of factors, but the two largest are the swath width and the orbit.</p>

<p><strong>Swath width</strong> is the width of a single image, and can either be small or large,  The image below (gratefully pilfered from Figure 1 in <a href="https://doi-org.www2.lib.ku.edu/10.1016/j.rse.2019.111254">https://doi-org.www2.lib.ku.edu/10.1016/j.rse.2019.111254</a>) shows the swath of a Landsat-8 OLI orbit (185 km wide, left) compared  and a Sentinel-2A MSI orbit (290 km wide, right).
<img src="/courses/random/media/Swathwidth.jpg" alt="" /></p>

<p><strong>Orbit</strong> refers to the direction and nature of the travel path of satellites around a body.  There are a number of common orbital patterns satellites exhibit.  For more information, see <a href="https://www.sciencelearn.org.nz/image_maps/13-satellites-and-orbits">an example of the different orbits and satellites</a>, and explore satellite orbits at this <a href="https://maps.esri.com/rc/sat/index.html">ESRI site</a>.<br />
<img src="/courses/random/media/SatelliteOrbits.PNG" alt="" /></p>

<ul>
<li>Geostationary: The orbit of the sensor is such that it rotates at a speed which maintains the satellites position over the same spot on the earth.  Most commonly seen with communication and weather satellites.</li>
<li>Sun synchronous: The orbit of this satellite follows the sun.</li>
</ul>

<h2 id="an-introduction-to-platforms"><strong>An introduction to platforms</strong></h2>

<p>As you might have guessed by now, a proper understanding of remote sensing hinges on a thorough understanding of the data structure and lineage.  Here we’ll introduce two of my favorite platforms, MODIS, and Landsat</p>

<h3 id="modis"><strong>MODIS</strong></h3>

<p><img src="/courses/random/media/MODIS-Aqua.jpg" alt="" />
<a href="https://modis.gsfc.nasa.gov/about/">MODIS,(Moderate Resolution Imaging Spectroradiometer)</a> is a key instrument aboard the Terra (originally known as EOS AM-1) and Aqua (originally known as EOS PM-1) satellites.  These are passive remote sensing platforms, and so follow a sun synchronous orbit.  Terra&rsquo;s orbit around the Earth is timed so that it passes from north to south across the equator in the morning, while Aqua passes south to north over the equator in the afternoon. Terra MODIS and Aqua MODIS are viewing the entire Earth&rsquo;s surface every 1 to 2 days, acquiring data in 36 spectral bands.</p>

<h3 id="landsat"><strong>LANDSAT</strong></h3>

<p><img src="/courses/random/media/landsat_8_01.jpg" alt="" />
The Landsat program is the longest-running enterprise for acquisition of satellite imagery of Earth. It is a joint NASA/USGS program. Back in July of 1972, the first satellite was launched, and eventually became known as Landsat 1.  The most recent satellite, Landsat 8, was launched on February 11, 2013, and is still currently operational. There are a few different sensors onboard, which are outlined below.  Landsat 1 through 5 carried the Landsat Multispectral Scanner (MSS). Landsat 4 and 5 carried both the MSS and Thematic Mapper &trade; instruments. Landsat 7 uses the Enhanced Thematic Mapper Plus (ETM+) scanner. Landsat 8 uses two instruments, the Operational Land Imager (OLI) for optical bands and the Thermal Infrared Sensor (TIRS) for thermal bands. Handy charts for these instruments can be found on the <a href="https://en.wikipedia.org/wiki/Landsat_program">wikipedia page</a>.</p>

<h4 id="landsat-distro"><strong>LANDSAT distro</strong></h4>

<p>wrs2.gif
<a href="https://www.usgs.gov/land-resources/nli/landsat/landsat-shapefiles-and-kml-files">https://www.usgs.gov/land-resources/nli/landsat/landsat-shapefiles-and-kml-files</a></p>

<h4 id="landsat-1"><strong>LANDSAT</strong></h4>

<p>The Landsat Collection 1 Level-1 product identifier includes the Collection processing levels, processing date, collection number, and collection iter category:</p>

<p>LXSS_LLLL_PPPRRR_YYYYMMDD_yyyymmdd_CC_TX</p>

<p>Where:</p>

<p>L = Landsat
X = Sensor (“C”=OLI/TIRS combined, “O”=OLI-only, “T”=TIRS-only, “E”=ETM+, “T”=“TM, “M”=MSS)
SS = Satellite (”07”=Landsat 7, “08”=Landsat 8)
LLL = Processing correction level (L1TP/L1GT/L1GS)
PPP = WRS path
RRR = WRS row
YYYYMMDD = Acquisition year, month, day
yyyymmdd - Processing year, month, day
CC = Collection number (01, 02, …)
TX = Collection category (“RT”=Real-Time, “T1”=Tier 1, “T2”=Tier 2)
Example:  LC08_L1GT_029030_20151209_20160131_01_RT</p>

<p>Means: Landsat 8; OLI/TIRS combined; processing correction level L1GT; path 029; row 030; acquired December 9, 2015; processed January 31, 2016; Collection 1; Real-Time</p>

<p>Schematic-of-Landsat-7-data-collection-in-SLC-On-a-and-SLC-Off-b-mode-and-a.png
<a href="https://www.researchgate.net/publication/236864661_Validating_gap-filling_of_Landsat_ETM_satellite_images_in_the_Golestan_Province_Iran">https://www.researchgate.net/publication/236864661_Validating_gap-filling_of_Landsat_ETM_satellite_images_in_the_Golestan_Province_Iran</a></p>

<h2 id="a-simple-application"><strong>A simple application</strong></h2>

<p>There are a number of uses for remote sensing data, but one of the cornerstones of remote sensing is the normalized difference index.  If we take two numbers and subtract them, and divide that by the sum of those same two numbers, we end up with a number that can range from -1 to 1.  This normalization can tell us a lot about a process, and is performed for a wide variety of earth classification operations such as snow (NDSI), water (NDWI), and vegetative health (NDVI).</p>

<p><img src="/courses/random/media/genericNDVI.PNG" alt="" /></p>

<p>The latter, NDVI, is an often performed analysis to give us a roughly quantitative analysis of the vegetative health of a system.  When sunlight strikes objects, some wavelengths of this spectrum are absorbed and other wavelengths are reflected. The pigment in plant leaves, chlorophyll, strongly absorbs visible light (from 0.4 to 0.7 µm) for use in photosynthesis, whereas the cell structure of the leaves strongly reflects near-infrared light (from 0.7 to 1.1 µm). The more leaves a plant has, the more these wavelengths of light are affected.  NDVI values are fairly relative (the difference between 0.5 to 0.6 is not generally quantifiable), but in general, anything above 0.2 is vegetation, and higher values are roughly equivalent to more vegetation.</p>

<p><img src="/courses/random/media/NDVITrees.jpg" alt="" />
Image from <a href="https://eos.com/ndvi/">https://eos.com/ndvi/</a></p>

<h2 id="lab-exercise"><strong>Lab exercise</strong></h2>

<p>Let&rsquo;s use our newfound knowledge to perform one of the most common operations one might want to take, a change detection study.  Let’s explore how NDVI changes by land cover type between summer and fall.  We&rsquo;ll use landsat 8.  If we look back at the landsat 8 OLS sensor (copied below), we can see that those wavelengths are equivalent to bands 4 and 5.</p>

<table>
<thead>
<tr>
<th>Band number</th>
<th>Spectral resolution</th>
<th>Spatial Resolution</th>
</tr>
</thead>

<tbody>
<tr>
<td>Band 1</td>
<td>Visible (0.43 - 0.45 µm)</td>
<td>30 m</td>
</tr>

<tr>
<td>Band 2</td>
<td>Visible (0.450 - 0.51 µm)</td>
<td>30 m</td>
</tr>

<tr>
<td>Band 3</td>
<td>Visible (0.53 - 0.59 µm)</td>
<td>30 m</td>
</tr>

<tr>
<td>Band 4</td>
<td>Red (0.64 - 0.67 µm)</td>
<td>30 m</td>
</tr>

<tr>
<td>Band 5</td>
<td>Near-Infrared (0.85 - 0.88 µm)</td>
<td>30 m</td>
</tr>

<tr>
<td>Band 6</td>
<td>SWIR 1(1.57 - 1.65 µm)</td>
<td>30 m</td>
</tr>

<tr>
<td>Band 7</td>
<td>SWIR 2 (2.11 - 2.29 µm)</td>
<td>30 m</td>
</tr>

<tr>
<td>Band 8</td>
<td>Panchromatic (PAN) (0.50 - 0.68 µm)</td>
<td>15 m</td>
</tr>

<tr>
<td>Band 9</td>
<td>Near-Infrared (0.85 - 0.88 µm)</td>
<td>30 m</td>
</tr>
</tbody>
</table>

<p>Let&rsquo;s lay out our workflow conceptually.  We&rsquo;ll first establish an area over which we&rsquo;ll perform the analysis.  Next, we&rsquo;ll scrape an amazon web service to identify suitable data to use for our analysis, and grab land cover data to perform our analysis.  Afterwards, we&rsquo;ll calculate NDVI and perform our zonal statistics using our land cover.  Finally, we&rsquo;ll create a pretty image as our output image.</p>

<p><img src="/courses/random/media/Workflows.png" alt="" /></p>

<div class="alert alert-note">
  <div>
    <p>You may notice a slightly unique naming convention in the code:</p>

<pre><code class="language-R"># Pick an AOI
xx &lt;- list() 
xx$AOI_center...
</code></pre>

<p>I like to create an empty list and stuff all cartographic variables into a single place for easy access when it comes time to create outputs.  This also makes it easer to create web apps (the global file then only has to return the list), but that will be a topic for a later date.</p>

  </div>
</div>
  

<h3 id="first-let-s-load-in-the-requisite-packages">First, let&rsquo;s load in the requisite packages</h3>

<pre><code># Last build: 7/30/20
# install.packages(&quot;devtools&quot;)  # Will throw errors if RTools is not installed, you can ignore this for the remained of installation
# install.packages(&quot;geosphere&quot;)  # For geodesic buffer function
# install.packages(&quot;leaflet&quot;)  # For visualization
# install.packages(&quot;leafem&quot;)  # For visualization
# install.packages(&quot;raster&quot;) # for raster vis
# library(devtools, quietly = TRUE)
# devtools::install_github(&quot;ropensci/FedData&quot;)  # For easy NLCD download
# devtools::install_github(c(&quot;ropensci/getlandsat&quot;))  # For easy landsat download

library(raster, quietly = TRUE)  # vis
library(dplyr, quietly = TRUE)  # Syntax sugar
library(lubridate, quietly = TRUE)  # more syntax sugar
library(rgeos, quietly = TRUE)  # second buffer function
library(jsonlite, quietly = TRUE)  # API query
library(httr, quietly = TRUE)  # web download
library(leaflet, quietly = TRUE)  # vis
library(leafem, quietly = TRUE)  # vis
library(htmltools, quietly = TRUE)  # vis
library(FedData, quietly = TRUE)  # Easy NLCD
library(getlandsat, quietly = TRUE)  # Easy landsat
</code></pre>

<h3 id="define-a-few-helper-functions">Define a few helper functions</h3>

<p>We&rsquo;ll use a few helper functions to help us accomplish this task, one to plot a point in the world for use as the centroid of our AOI, and another to generate the approprite utm epsg for that point.</p>

<pre><code>## Helper functions

## geocoding function using OSM Nominatim API -- details: http://wiki.openstreetmap.org/wiki/Nominatim
## Inputs: a human readable address or colloquial name string
## Outputs: success: a sf point with lat and long | Failure: an empty dataframe
## modified from: D.Kisler @ https://datascienceplus.com/osm-nominatim-with-r-getting-locations-geo-coordinates-by-its-address/
nominatim_osm &lt;- function(address = NULL) {
  # Construct a url request
  d &lt;- jsonlite::fromJSON( 
    gsub('\\@addr\\@', gsub('\\s+', '\\%20', address), 'http://nominatim.openstreetmap.org/search/@addr@?format=json&amp;addressdetails=0&amp;limit=1'))
  
  # return parsed sf point
  return(
    sf::st_as_sf(d %&gt;% select('lon','lat','display_name'),
                 coords=c(&quot;lon&quot;,&quot;lat&quot;), 
                 crs=sf::st_crs(4326),
                 remove=TRUE)
  )
}

## geodesic buffer function -- details: http://wiki.openstreetmap.org/wiki/Nominatim
## Inputs: a coordinate pair in EPSG:4326
## Outputs: the equivelent UTM zone EPSG
## all credit to Robin Lovelace, Jakub Nowosad, Jannes Muenchow @ https://geocompr.robinlovelace.net/reproj-geo-data.html
lonlat2UTM = function(lonlat) {
  utm = (floor((lonlat[1] + 180) / 6) %% 60) + 1
  if(lonlat[2] &gt; 0) {
    utm + 32600
  } else{
    utm + 32700
  }
}
</code></pre>

<h3 id="define-our-aoi-and-a-small-processing-area">Define our AOI and a small processing area</h3>

<p>First, let&rsquo;s define our AOI and a small buffer</p>

<pre><code># set a working directory
setwd(&quot;C:/Users/Cornholio/Desktop/coolclass&quot;) # your own filepath here

# Pick an AOI and (small) buffer distance
xx &lt;- list() 
xx$AOI_center &lt;- nominatim_osm(&quot;Lawrence, KS&quot;) 
# xx$AOI_center &lt;- sp::SpatialPoints(list(-95.23595,38.97194)) %&gt;% sf::st_as_sfc() %&gt;% sf::st_set_crs(4326) # or spesify a lon/lat point
mybufferdist_m = 1200

# Buffer AOI point
# get UTM epsg
aoiUTMEPSG &lt;- lonlat2UTM(sf::st_coordinates(xx$AOI_center))
# reproject
xx$AOI_center_utm &lt;- sf::st_transform(xx$AOI_center,aoiUTMEPSG)
# buffer (gBuffer requires a spatial object, not an sf), return to sf, reattach crs
xx$AOI_buffer_utm &lt;- rgeos::gBuffer(sp::SpatialPoints(sf::st_coordinates(xx$AOI_center_utm)),width = mybufferdist_m) %&gt;%
  sf::st_as_sfc() %&gt;%
  sf::st_set_crs(aoiUTMEPSG) 
  
xx$AOI_buffer_utm &lt;- rgeos::gBuffer(sp::SpatialPoints(sf::st_coordinates(xx$AOI_center_utm)),width = mybufferdist_m) %&gt;%
  sf::st_as_sfc()
sf::st_crs(xx$AOI_buffer_utm) = aoiUTMEPSG
  
xx$AOI_buffer &lt;- sf::st_transform(xx$AOI_buffer_utm, 4326) # reproject back to wgs84
xx$processbounds &lt;- sf::st_bbox(xx$AOI_buffer) 
# st_bbox doesn't return a spatial object, so we'll correct for that here
xx$AOI_bbox &lt;- sf::st_bbox(xx$AOI_buffer) %&gt;% sf::st_as_sfc() %&gt;% sf::st_set_crs(4326)

# Finally, let's make sure everything plots as expected
leaflet() %&gt;%
  addProviderTiles(providers$Stamen.TonerLite, group = &quot;Base Map&quot;) %&gt;%
  addPolygons(data=xx$AOI_buffer,color=&quot;red&quot;)
</code></pre>

<h3 id="discover-approprite-scenes-for-processing">Discover approprite scenes for processing</h3>

<p>We next need to identify scenes for use.  Landsat distriburts scenes by path and row <strong>more here</strong></p>

<pre><code># discover path and row
httr::GET('https://prd-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/atoms/files/WRS2_descending_0.zip', 
          write_disk(paste0(getwd(), &quot;/WRS2_descending_0.zip&quot;)))
unzip(paste0(getwd(), &quot;/WRS2_descending_0.zip&quot;), exdir = getwd())
xx$pathrow &lt;- sf::read_sf(paste0(getwd(), &quot;/WRS2_descending.shp&quot;))

# That pathrow file covers the entire globe, let's make this a tiny bit gentler to visualize
# and subset that to just the pathrows that intersect our AOI
xx$pathrow_subset &lt;- xx$pathrow[xx$AOI_bbox,]

# explore geographic context
leaflet() %&gt;%
  addProviderTiles(providers$Stamen.TonerLite, group = &quot;Base Map&quot;) %&gt;%
  addPolygons(data=xx$AOI_buffer,color=&quot;red&quot;) %&gt;%
  addPolygons(data=xx$pathrow_subset,
              color=&quot;black&quot;,
              fill = FALSE,
              label = mapply(function(x, y) {
                HTML(sprintf(&quot;&lt;em&gt;Path/row:&lt;/em&gt;%s-%s&quot;, htmlEscape(x), htmlEscape(y)))},
                xx$pathrow_subset$PATH, xx$pathrow_subset$ROW, SIMPLIFY = F),
              labelOptions = lapply(1:nrow(xx$pathrow_subset), function(x) {
                labelOptions(noHide = T)
              })) %&gt;% 
  fitBounds(as.numeric(floor(xx$processbounds$xmin)), 
            as.numeric(floor(xx$processbounds$ymin)), 
            as.numeric(ceiling(xx$processbounds$xmax)), 
            as.numeric(ceiling(xx$processbounds$ymax)))
</code></pre>

<h3 id="discover-approprite-scenes-for-processing-part-2">Discover approprite scenes for processing <strong>part 2</strong></h3>

<p>That visualization was perhaps a bit overkill, all we needed to do here is ensure that our AOI is completely enclosed within a single path/row.  We&rsquo;ll cover mosaicking (stitching together multiple scenes at once) later in the course, but for now if you end up inside more than one, adjust your point until you fall squarely within a single tile (or entirely in a crossover section).</p>

<p>Having identified our path and row, let&rsquo;s now explore the landsat catalog</p>

<pre><code># Find the scenes for your path and row
summerdaterange &lt;- interval(as.POSIXct(&quot;2015-06-01 00:00:00&quot;), 
                            as.POSIXct(&quot;2015-09-01 00:00:00&quot;))   

summerscene &lt;- getlandsat::lsat_scenes() %&gt;% 
  filter(row == xx$pathrow_subset$ROW) %&gt;%                # Filter for row...
  filter(path == xx$pathrow_subset$PATH) %&gt;%              # and path
  filter(acquisitionDate %within% summerdaterange) %&gt;%    # get our date
  arrange(cloudCover) %&gt;%                                 # put the least cloudy scene first
  .[1,]                                                   # and peel it off

summerscene
# as we see, there is a suitable cloud free scene, let's look at it's formatting:


# In addition to making a handy scene scrapper, the getLandsat package is also a wrapper to download scenes by name
summer_band4_path &lt;- getlandsat::lsat_image(paste0(summerscene$entityId,&quot;_B4.TIF&quot;)) 
summer_band4 &lt;- raster::raster(summer_band4_path)
xx$summer_band4 &lt;- raster::mask(summer_band4,sf::as_Spatial(xx$AOI_buffer_utm)) 

# and visualize
leaflet() %&gt;% 
  addProviderTiles(providers$Stamen.TonerLite, group = &quot;Base Map&quot;) %&gt;%
  addRasterImage(xx$summer_band4, layerId = &quot;values&quot;) %&gt;% 
  addMouseCoordinates() %&gt;%
  addImageQuery(xx$summer_band4, type=&quot;mousemove&quot;, layerId = &quot;values&quot;)

# Lets do the same for band 5
summer_band5_path &lt;- getlandsat::lsat_image(paste0(summerscene$entityId,&quot;_B5.TIF&quot;)) 
summer_band5 &lt;- raster::raster(summer_band5_path)
xx$summer_band5 &lt;- raster::mask(summer_band5,sf::as_Spatial(xx$AOI_buffer_utm)) 
</code></pre>

<h3 id="creating-ndvi-values">Creating NDVI values</h3>

<p>Now, let&rsquo;s perform our local operation</p>

<pre><code>summer_ndvi &lt;- raster::overlay(xx$summer_band5, xx$summer_band4, fun = function(r1, r2) { return( (r1 - r2)/(r1 + r2)) })

# and visualize
leaflet() %&gt;% 
  addProviderTiles(providers$Stamen.TonerLite, group = &quot;Base Map&quot;) %&gt;%
  addRasterImage(summer_ndvi, layerId = &quot;values&quot;) %&gt;% 
  addMouseCoordinates() %&gt;%
  addImageQuery(summer_ndvi, type=&quot;mousemove&quot;, layerId = &quot;values&quot;)
</code></pre>

<h3 id="grabbing-land-cover">Grabbing land cover</h3>

<p>Now that we have NDVI, we need a land cover dataset.  <strong>more here about NLCD</strong></p>

<pre><code>NLCD &lt;- FedData::get_nlcd(template = sf::as_Spatial(xx$AOI_buffer_utm),
                          year = 2016,
                          dataset = &quot;Land_Cover&quot;,
                          label = &quot;AOI&quot;)
# --------------------------------------------------------------------------------------------
# backup, because MRLC service is down more often than it's up...
# this may take a while because we're grabbing all of CONUS
httr::GET('https://s3-us-west-2.amazonaws.com/mrlc/NLCD_2016_Land_Cover_L48_20190424.zip', 
          write_disk(paste0(getwd(), &quot;/NLCD_2016_Land_Cover_L48.zip&quot;)))
unzip(paste0(getwd(), &quot;/NLCD_2016_Land_Cover_L48.zip&quot;), exdir = getwd())
NLCD &lt;- raster::raster(paste0(getwd(),'/NLCD_2016_Land_Cover_L48_20190424.img'))
# --------------------------------------------------------------------------------------------
landcover_utm &lt;- NLCD %&gt;%
  raster::projectRaster(crs = raster::crs(xx$summer_band4)) %&gt;%
  raster::mask(sf::as_Spatial(xx$AOI_buffer_utm))

landcover_utm &lt;- NLCD %&gt;%
  raster::projectRaster(crs = raster::crs(xx$summer_band4)) %&gt;%
  raster::mask(sf::as_Spatial(xx$AOI_buffer_utm))
# Finally, we'll (visualize) write the raster to disk, garbage collect, and reload the layer as that was a fairly
# expensive set of computations we just performed
# Land cover color pallete values
xx$NLCD.pal &lt;- c(&quot;#5475A8&quot;,&quot;#FFFFFF&quot;,&quot;#E8D1D1&quot;,&quot;#E29E8C&quot;,&quot;#FF0000&quot;,&quot;#B50000&quot;,&quot;#D2CDC0&quot;,&quot;#85C77E&quot;,&quot;#38814E&quot;,&quot;#D4E7B0&quot;,&quot;#AF963C&quot;,&quot;#DCCA8F&quot;,&quot;#FDE9AA&quot;,&quot;#D1D182&quot;,&quot;#A3CC51&quot;,&quot;#82BA9E&quot;,&quot;#FBF65D&quot;,&quot;#CA9146&quot;,&quot;#C8E6F8&quot;,&quot;#64B3D5&quot;)
xx$NLCD.val &lt;- as.numeric(c(11,12,21,22,23,24,31,41,42,43,51,52,71,72,73,74,81,82,90,95))
xx$NLCD.text &lt;- c(&quot;Open Water&quot;,&quot;Perennial Ice/Snow&quot;,&quot;Developed, Open Space&quot;,&quot;Developed, Low Intensity&quot;,&quot;Developed, Medium Intensity&quot;,&quot;Developed, High Intensity&quot;,&quot;Barren Land&quot;,&quot;Deciduous Forest&quot;,&quot;Evergreen Forest&quot;,&quot;Mixed Forest&quot;,
                  &quot;Dwarf Scrub&quot;,&quot;Shrub/Scrub&quot;,&quot;Grassland/Herbaceous&quot;,&quot;Sedge/Herbaceous&quot;,&quot;Lichens&quot;,&quot;Moss&quot;,&quot;Pasture/Hay&quot;,&quot;Cultivated Crops&quot;,&quot;Woody Wetlands&quot;,&quot;Emergent Herbaceous Wetlands&quot;)
xx$NLCD.vis &lt;- colorFactor(palette = xx$NLCD.pal,
                           domain = xx$NLCD.val)

leaflet() %&gt;%
  addProviderTiles(providers$Stamen.TonerLite, group = &quot;Base Map&quot;) %&gt;%
  addRasterImage(NLCD,colors=xx$NLCD.vis) %&gt;%
  addLegend(&quot;bottomright&quot;,
            title = &quot;National Land Cover Data&quot;, 
            colors = xx$NLCD.pal,
            labels = xx$NLCD.text)

raster::writeRaster(landcover_utm,paste0(getwd(),&quot;/AOI_LC.tif&quot;))
gc()
xx$landcover &lt;- raster::raster(paste0(getwd(),&quot;/AOI_LC.tif&quot;))
</code></pre>

<h3 id="zonal-statistics">zonal statistics</h3>

<p>We now have all the pieces we need to generate the desired statistics, our last step is to perform the zonal statistics</p>

<pre><code>xx$summer_ndvi &lt;- raster::resample(summer_ndvi,xx$landcover,method=&quot;bilinear&quot;)
xx$zonalstats &lt;- raster::zonal(xx$summer_ndvi, xx$landcover, fun='mean', digits=0, na.rm=TRUE) 
</code></pre>

<h3 id="finishing-up">Finishing up</h3>

<p><strong>add here</strong>
<a href="https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C01_T1_32DAY_NDVI">https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C01_T1_32DAY_NDVI</a></p>

          </div>

          



          
        </div>

        <div class="body-footer">
          <p>Last updated on Jan 1, 0001</p>

          


          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin="anonymous"></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
